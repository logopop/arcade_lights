//*********************************************************************************************************************
//  Arcade lights IR routines
//   
//  
//    
//*********************************************************************************************************************
//
 
#include <htc.h>
#include <arcade_lights.h>
#include <xc.h>
#include <stdio.h>
#include <stdlib.h>
 
//*********************************************************************************************************************
//

extern unsigned long ulLcounter;                   // Delay counter
extern unsigned char cLstate;                      // Main state  0:lights off 1:starting 2:running 3:stopping 4:light on
extern unsigned char cLoldstate;                   // Previous state
extern unsigned char cLseq;                        // Current sequence
extern unsigned char cLstep;                       // Current step in sequence
 
 
//*********************************************************************************************************************
// Port write
// 
//*********************************************************************************************************************
//
//                       41   42
//    01   02   03   04           21   22   23   24
//
//    11   12   13   14           31   32   33   34
//

void vToggle(unsigned char ucLight, unsigned char ucState)
{
   switch (ucLight)
   {
      // Control buttons
      case LT1:   MLT1 = ucState;   break;
      case LT2:   MLT2 = ucState;   break;
      case LT3:   MLT3 = ucState;   break;
      case LT4:   MLT4 = ucState;   break;
         
      case LB1:   MLB1 = ucState;   break;
      case LB2:   MLB2 = ucState;   break;
      case LB3:   MLB3 = ucState;   break;
      case LB4:   MLB4 = ucState;   break;
      
      case RT1:   MRT1 = ucState;   break;
      case RT2:   MRT2 = ucState;   break;
      case RT3:   MRT3 = ucState;   break;
      case RT4:   MRT4 = ucState;   break;
         
      case RB1:   MRB1 = ucState;   break;
      case RB2:   MRB2 = ucState;   break;
      case RB3:   MRB3 = ucState;   break;
      case RB4:   MRB4 = ucState;   break;          

      // Player buttons
      case PLAYER1:   MPLAYER1 = ucState;   break;
      case PLAYER2:   MPLAYER2 = ucState;   break;          
   }
}

//*********************************************************************************************************************
// Patterns
// 
//*********************************************************************************************************************
//

void vSwitchlights(unsigned char uc1, unsigned char uc2, unsigned char uc3)
{
   // Left lights 
   if (uc1 & 0b10000000) vToggle(LT1, LON); else vToggle(LT1, LOFF);
   if (uc1 & 0b01000000) vToggle(LT2, LON); else vToggle(LT2, LOFF);
   if (uc1 & 0b00100000) vToggle(LT3, LON); else vToggle(LT3, LOFF);
   if (uc1 & 0b00010000) vToggle(LT4, LON); else vToggle(LT4, LOFF);
   if (uc1 & 0b00001000) vToggle(LB1, LON); else vToggle(LB1, LOFF);
   if (uc1 & 0b00000100) vToggle(LB2, LON); else vToggle(LB2, LOFF);
   if (uc1 & 0b00000010) vToggle(LB3, LON); else vToggle(LB3, LOFF);
   if (uc1 & 0b00000001) vToggle(LB4, LON); else vToggle(LB4, LOFF);
   
   // Right lights
   if (uc2 & 0b10000000) vToggle(RT1, LON); else vToggle(RT1, LOFF);
   if (uc2 & 0b01000000) vToggle(RT2, LON); else vToggle(RT2, LOFF);
   if (uc2 & 0b00100000) vToggle(RT3, LON); else vToggle(RT3, LOFF);
   if (uc2 & 0b00010000) vToggle(RT4, LON); else vToggle(RT4, LOFF);
   if (uc2 & 0b00001000) vToggle(RB1, LON); else vToggle(RB1, LOFF);
   if (uc2 & 0b00000100) vToggle(RB2, LON); else vToggle(RB2, LOFF);
   if (uc2 & 0b00000010) vToggle(RB3, LON); else vToggle(RB3, LOFF);
   if (uc2 & 0b00000001) vToggle(RB4, LON); else vToggle(RB4, LOFF);
   
   // Player buttons
   if (uc3 & 0b10000000) vToggle(PLAYER1, LON); else vToggle(PLAYER1, LOFF);
   if (uc3 & 0b01000000) vToggle(PLAYER2, LON); else vToggle(PLAYER2, LOFF);
}

//*********************************************************************************************************************
// Patterns
// 
//*********************************************************************************************************************
//

static const unsigned char cStarting[][3] =
{
   // Left        Right       Players 
   {0b10000000, 0b00000000, 0b00000000},  
   {0b01000000, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00010000, 0b00000000, 0b00000000},  
   {0b00000000, 0b10000000, 0b00000000},  
   {0b00000000, 0b01000000, 0b00000000},  
   {0b00000000, 0b00100000, 0b00000000},  
   {0b00000000, 0b00010000, 0b00000000},  
   {0b00000000, 0b00000001, 0b00000000},  
   {0b00000000, 0b00000010, 0b00000000},  
   {0b00000000, 0b00000100, 0b00000000},  
   {0b00000000, 0b00001000, 0b00000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00000010, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b00001000, 0b00000000, 0b00000000},  

   {0b10000000, 0b00000001, 0b00000000},  
   {0b11000000, 0b00000011, 0b00000000},  
   {0b11100000, 0b00000111, 0b00000000},  
   {0b11111000, 0b00011111, 0b00000000},  
   {0b11111100, 0b00111111, 0b11000000},  
   {0b11111110, 0b01111111, 0b11000000},  
   {0b11111111, 0b11111111, 0b11000000},  
};

//*********************************************************************************************************************
//

const unsigned char cStopping[][3] =
{
   // Left        Right       Players 
   {0b11111111, 0b11111111, 0b11000000},  
   {0b01111111, 0b11101111, 0b11000000},  
   {0b10110111, 0b11011110, 0b11000000},  
   {0b01011011, 0b10101101, 0b11000000},  
   {0b00100101, 0b01001010, 0b11000000},  
   {0b00010010, 0b10000100, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
         
};

//*********************************************************************************************************************
//
// LT1 LT2 LT3 LT4 LB1 LB2 LB3 LB4 - RT1 RT2 RT3 RT4 RB1 RB2 RB3 RB4 - PL1 PL2  

const unsigned char cRunning1[][3] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b11000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b11000000},  
   {0b00010000, 0b10000000, 0b00000000}, 
   {0b00100000, 0b01000000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b11000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b11000000},  
   
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000}       
};

// LT1 LT2 LT3 LT4 LB1 LB2 LB3 LB4 - RT1 RT2 RT3 RT4 RB1 RB2 RB3 RB4 - PL1 PL2  
const unsigned char cRunning2[][3] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000}, 
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000}, 
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b10000000, 0b00010000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000001, 0b00001000, 0b00000000}, 
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000001, 0b00001000, 0b00000000},  
   {0b00010000, 0b10000000, 0b00000000},  
   {0b00000010, 0b00000100, 0b00000000},  
   {0b00100000, 0b01000000, 0b00000000},  
   {0b00000100, 0b00000010, 0b00000000},  
   {0b01000000, 0b00100000, 0b00000000},  
   {0b00001000, 0b00000001, 0b00000000},   

   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000}         
};

// LT1 LT2 LT3 LT4 LB1 LB2 LB3 LB4 - RT1 RT2 RT3 RT4 RB1 RB2 RB3 RB4 - PL1 PL2  
const unsigned char cRunning3[][3] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00010000, 0b00000000, 0b10000000},  
   {0b00110000, 0b00000000, 0b10000000},  
   {0b01110000, 0b00000000, 0b10000000},  
   {0b11110000, 0b00000000, 0b10000000},  
   {0b11111000, 0b00000000, 0b10000000},  
   {0b11111100, 0b00000000, 0b10000000},  
   {0b11111110, 0b00000000, 0b10000000},  
   {0b11111111, 0b00000000, 0b10000000},  
   {0b11111111, 0b00001000, 0b00000000},  
   {0b11101111, 0b00001100, 0b00000000},  
   {0b11001111, 0b00001110, 0b00000000},  
   {0b10001111, 0b00001111, 0b00000000},  
   {0b00001111, 0b00011111, 0b00000000},  
   {0b00000111, 0b00111111, 0b00000000},  
   {0b00000011, 0b01111111, 0b00000000},  
   {0b00000001, 0b11111111, 0b00000000},  
   {0b00000000, 0b11110111, 0b01000000},  
   {0b00000000, 0b11110011, 0b01000000},  
   {0b00000000, 0b11110001, 0b01000000},  
   {0b00000000, 0b11110000, 0b01000000},  
   {0b00000000, 0b11100000, 0b01000000},  
   {0b00000000, 0b11000000, 0b01000000},  
   {0b00000000, 0b10000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b00000000},  
// 27   
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b10000000, 0b01000000},  
   {0b00000000, 0b11000000, 0b01000000},  
   {0b00000000, 0b11100000, 0b01000000},  
   {0b00000000, 0b11110000, 0b01000000},  
   {0b00000000, 0b11110001, 0b01000000},  
   {0b00000000, 0b11110011, 0b01000000},  
   {0b00000000, 0b11110111, 0b01000000},  
   {0b00000001, 0b11111111, 0b00000000},  
   {0b00000011, 0b01111111, 0b00000000},  
   {0b00000111, 0b00111111, 0b00000000},  
   {0b00001111, 0b00011111, 0b00000000},  
   {0b10001111, 0b00001111, 0b00000000},  
   {0b11001111, 0b00001110, 0b00000000},  
   {0b11101111, 0b00001100, 0b00000000},  
   {0b11111111, 0b00001000, 0b00000000},  
   {0b11111111, 0b00000000, 0b10000000},  
   {0b11111110, 0b00000000, 0b10000000},  
   {0b11111100, 0b00000000, 0b10000000},  
   {0b11111000, 0b00000000, 0b10000000},  
   {0b11110000, 0b00000000, 0b10000000},  
   {0b01110000, 0b00000000, 0b10000000},  
   {0b00110000, 0b00000000, 0b10000000},  
   {0b00010000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   // 53
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00010000, 0b00000000, 0b10000000},  
   {0b00110000, 0b00000000, 0b10000000},  
   {0b01110000, 0b00000000, 0b10000000},  
   {0b11110000, 0b00000000, 0b10000000},  
   {0b11111000, 0b00000000, 0b10000000},  
   {0b11111100, 0b00000000, 0b10000000},  
   {0b11111110, 0b00000000, 0b10000000},  
   {0b11111111, 0b00000000, 0b10000000},  
   {0b11111111, 0b00001000, 0b00000000},  
   {0b11101111, 0b00001100, 0b00000000},  
   {0b11001111, 0b00001110, 0b00000000},  
   {0b10001111, 0b00001111, 0b00000000},  
   {0b00001111, 0b00011111, 0b00000000},  
   {0b00000111, 0b00111111, 0b00000000},  
   {0b00000011, 0b01111111, 0b00000000},  
   {0b00000001, 0b11111111, 0b00000000},  
   {0b00000000, 0b11110111, 0b01000000},  
   {0b00000000, 0b11110011, 0b01000000},  
   {0b00000000, 0b11110001, 0b01000000},  
   {0b00000000, 0b11110000, 0b01000000},  
   {0b00000000, 0b11100000, 0b01000000},  
   {0b00000000, 0b11000000, 0b01000000},  
   {0b00000000, 0b10000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b00000000},  
 // 79  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b10000000, 0b01000000},  
   {0b00000000, 0b11000000, 0b01000000},  
   {0b00000000, 0b11100000, 0b01000000},  
   {0b00000000, 0b11110000, 0b01000000},  
   {0b00000000, 0b11110001, 0b01000000},  
   {0b00000000, 0b11110011, 0b01000000},  
   {0b00000000, 0b11110111, 0b01000000},  
   {0b00000001, 0b11111111, 0b00000000},  
   {0b00000011, 0b01111111, 0b00000000},  
   {0b00000111, 0b00111111, 0b00000000},  
   {0b00001111, 0b00011111, 0b00000000},  
   {0b10001111, 0b00001111, 0b00000000},  
   {0b11001111, 0b00001110, 0b00000000},  
   {0b11101111, 0b00001100, 0b00000000},  
   {0b11111111, 0b00001000, 0b00000000},  
   {0b11111111, 0b00000000, 0b10000000},  
   {0b11111110, 0b00000000, 0b10000000},  
   {0b11111100, 0b00000000, 0b10000000},  
   {0b11111000, 0b00000000, 0b10000000},  
   {0b11110000, 0b00000000, 0b10000000},  
   {0b01110000, 0b00000000, 0b10000000},  
   {0b00110000, 0b00000000, 0b10000000},  
   {0b00010000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   
   // 104
   {0b00000000, 0b00000000, 0b00000000},      
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000}       

};

// LT1 LT2 LT3 LT4 LB1 LB2 LB3 LB4 - RT1 RT2 RT3 RT4 RB1 RB2 RB3 RB4 - PL1 PL2  
const unsigned char cRunning4[][3] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b11110000, 0b11110000, 0b11000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b00001111, 0b00001111, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  

   {0b10000000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
 // 20
   {0b00000000, 0b00001000, 0b00000000},  
   {0b00000000, 0b01000000, 0b00000000},  
   {0b00000000, 0b00000010, 0b00000000},  
   {0b00000000, 0b00010000, 0b00000000},  
   {0b00000000, 0b00000001, 0b00000000},  
   {0b00000000, 0b00100000, 0b00000000},  
   {0b00000000, 0b00000100, 0b00000000},  
   {0b00000000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b10000000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00001000, 0b00000000},  
 // 40
   {0b00000000, 0b01000000, 0b00000000},  
   {0b00000000, 0b00000010, 0b00000000},  
   {0b00000000, 0b00010000, 0b00000000},  
   {0b00000000, 0b00000001, 0b00000000},  
   {0b00000000, 0b00100000, 0b00000000},  
   {0b00000000, 0b00000100, 0b00000000},  
   {0b00000000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b10000000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00001000, 0b00000000},  
   {0b00000000, 0b01000000, 0b00000000},  
// 60
   {0b00000000, 0b00000010, 0b00000000},  
   {0b00000000, 0b00010000, 0b00000000},  
   {0b00000000, 0b00000001, 0b00000000},  
   {0b00000000, 0b00100000, 0b00000000},  
   {0b00000000, 0b00000100, 0b00000000},  
   {0b00000000, 0b10000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b10000000},  
   {0b00000000, 0b00000000, 0b01000000},  
   {0b00000001, 0b00000000, 0b00000000},  
   {0b00100000, 0b00000000, 0b00000000},  
   {0b00000100, 0b00000000, 0b00000000},  
   
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000}       
};

// LT1 LT2 LT3 LT4 LB1 LB2 LB3 LB4 - RT1 RT2 RT3 RT4 RB1 RB2 RB3 RB4 - PL1 PL2  
const unsigned char cRunning5[][3] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},   
   {0b00001000, 0b00000001, 0b00000000},       
   {0b10001100, 0b00010011, 0b00000000},       
   {0b11000110, 0b00110110, 0b00000000},   
   {0b01100011, 0b01101100, 0b00000000},       
   {0b00110001, 0b11001000, 0b00000000},       
   {0b00010001, 0b10001000, 0b11000000},   
   {0b00000000, 0b00001100, 0b11000000},       
   {0b00010001, 0b10000110, 0b11000000},       
   {0b00110001, 0b11000011, 0b00000000},   
   {0b01100011, 0b01100001, 0b00000000},       
   {0b11000110, 0b00110000, 0b00000000},       
   {0b10001100, 0b00010000, 0b00000000},   
   {0b00001000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   // 15
   {0b00001000, 0b00000001, 0b00000000},       
   {0b10001100, 0b00010011, 0b00000000},       
   {0b11000110, 0b00110110, 0b00000000},   
   {0b01100011, 0b01101100, 0b00000000},       
   {0b00110001, 0b11001000, 0b00000000},       
   {0b00010001, 0b10001000, 0b11000000},   
   {0b00000000, 0b00001100, 0b11000000},       
   {0b00010001, 0b10000110, 0b11000000},       
   {0b00110001, 0b11000011, 0b00000000},   
   {0b01100011, 0b01100001, 0b00000000},       
   {0b11000110, 0b00110000, 0b00000000},       
   {0b10001100, 0b00010000, 0b00000000},   
   {0b00001000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   //29
   {0b00001000, 0b00000000, 0b00000000},       
   {0b10001100, 0b00010000, 0b00000000},   
   {0b11000110, 0b00110000, 0b00000000},       
   {0b01100011, 0b01100001, 0b00000000},       
   {0b00110001, 0b11000011, 0b00000000},   
   {0b00010001, 0b10000110, 0b11000000},       
   {0b00000000, 0b00001100, 0b11000000},       
   {0b00010001, 0b10001000, 0b11000000},   
   {0b00110001, 0b11001000, 0b00000000},       
   {0b01100011, 0b01101100, 0b00000000},       
   {0b11000110, 0b00110110, 0b00000000},   
   {0b10001100, 0b00010011, 0b00000000},       
   {0b00001000, 0b00000001, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000},       
   // 43
   {0b00000000, 0b00000000, 0b00000000},       
   {0b00000000, 0b00000000, 0b00000000}       

};

/*
const unsigned char cNULL[][] =
{
   // Left        Right       Players 
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000},  
   {0b00000000, 0b00000000, 0b00000000}       
  
*/ 

//********************************************************************************************************************* 
// 
//*********************************************************************************************************************
//

void vStartPattern(void)
{
   unsigned char uc1       = 0;
   unsigned char uc2       = 0;
   unsigned char uc3       = 0;
   
   uc1 = cStarting[cLstep][0];
   uc2 = cStarting[cLstep][1];
   uc3 = cStarting[cLstep][2];
   
   vSwitchlights(uc1, uc2, uc3);   
   cLstep++;
   
   // Move on?
   if (cLstep > 22)        // Rows 0 - 22
   {
      // Started, set to on
      cLstep = 0;
      cLstate = 4;      
   }      
}

//********************************************************************************************************************* 
// 
//*********************************************************************************************************************
//

void vStopPattern(void)
{
   unsigned char uc1       = 0;
   unsigned char uc2       = 0;
   unsigned char uc3       = 0;
   
   uc1 = cStopping[cLstep][0];
   uc2 = cStopping[cLstep][1];
   uc3 = cStopping[cLstep][2];
   
   vSwitchlights(uc1, uc2, uc3);   
   cLstep++;
   
   // Move on?
   if (cLstep > 8)        // Rows 0 - 8
   {
      // Stopped, set to off
      cLstep = 0;
      cLstate = 0;      
   }      
}

//********************************************************************************************************************* 
// 
//*********************************************************************************************************************
//

void vRunPattern(void)
{
   unsigned char uc1       = 0;
   unsigned char uc2       = 0;
   unsigned char uc3       = 0;
   
   switch (cLseq)
   {
      case 0:
         uc1 = rand() % 255; 
         uc2 = rand() % 255; 
         uc3 = rand() % 255;     
         vSwitchlights(uc1, uc2, uc3);    
         cLstep++;
         if (cLstep > 200)
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4
         }   
      break;
      
      case 1:
         uc1 = cRunning1[cLstep][0];
         uc2 = cRunning1[cLstep][1];
         uc3 = cRunning1[cLstep][2];   
         vSwitchlights(uc1, uc2, uc3);   
         cLstep++;
   
         // Move on?
         if (cLstep > 53)        
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4            
         }                   
      break;  
  
      case 2:
         uc1 = cRunning2[cLstep][0];
         uc2 = cRunning2[cLstep][1];
         uc3 = cRunning2[cLstep][2];   
         vSwitchlights(uc1, uc2, uc3);   
         cLstep++;
   
         // Move on?
         if (cLstep > 53)        // Rows 0 - 8
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4            
         }                   
      break;  
      
      case 3:
         uc1 = cRunning3[cLstep][0];
         uc2 = cRunning3[cLstep][1];
         uc3 = cRunning3[cLstep][2];   
         vSwitchlights(uc1, uc2, uc3);   
         cLstep++;
   
         // Move on?
         if (cLstep > 104)        // Rows 0 - 8
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4            
         }                   
      break;  
      
      case 4:
         uc1 = cRunning4[cLstep][0];
         uc2 = cRunning4[cLstep][1];
         uc3 = cRunning4[cLstep][2];   
         vSwitchlights(uc1, uc2, uc3);   
         cLstep++;
   
         // Move on?
         if (cLstep > 72)        // Rows 0 - 8
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4            
         }                   
      break;        

      case 5:
         uc1 = cRunning5[cLstep][0];
         uc2 = cRunning5[cLstep][1];
         uc3 = cRunning5[cLstep][2];   
         vSwitchlights(uc1, uc2, uc3);   
         cLstep++;
   
         // Move on?
         if (cLstep > 43)        // Rows 0 - 8
         {
            cLstep = 0;
            cLseq = rand() % 6;   // 0-4            
         }                   
      break;        
   }             
}

//********************************************************************************************************************* 
// 
//*********************************************************************************************************************
//

void vPortOn(void)
{
   MLT1 = LON; 
   MLT2 = LON; 
   MLT3 = LON; 
   MLT4 = LON; 
   MLB1 = LON; 
   MLB1 = LON; 
   MLB1 = LON; 
   MLB1 = LON; 
   MRT1 = LON; 
   MRT2 = LON; 
   MRT3 = LON; 
   MRT4 = LON; 
   MRB1 = LON; 
   MRB1 = LON; 
   MRB1 = LON; 
   MRB1 = LON;    
}

//********************************************************************************************************************* 
// 
//*********************************************************************************************************************
//

void vPortOff(void)
{
   MLT1 = LOFF; 
   MLT2 = LOFF; 
   MLT3 = LOFF; 
   MLT4 = LOFF; 
   MLB1 = LOFF; 
   MLB1 = LOFF; 
   MLB1 = LOFF; 
   MLB1 = LOFF; 
   MRT1 = LOFF; 
   MRT2 = LOFF; 
   MRT3 = LOFF; 
   MRT4 = LOFF; 
   MRB1 = LOFF; 
   MRB1 = LOFF; 
   MRB1 = LOFF; 
   MRB1 = LOFF;    
}
 
//*********************************************************************************************************************
// Main pattern routine
// 
//*********************************************************************************************************************
//

void vPatterns(void) 
{
   switch(cLstate)            // 0:lights off 1:starting 2:running 3:stopping 4:lights on
   {
      case 0:                 // Off
         if (cLstate != cLoldstate)
         {
            cLoldstate = cLstate;
            vPortOff();            
         }   
      break;      
      
      case 1:                 // Starting
         if (cLstate != cLoldstate)
         {
            cLoldstate = cLstate;
            vPortOff();            
            cLstep = 0;
         }   
         // Pattern step
         vStartPattern();                           
      break;
      
      case 2:                 // Running
         if (cLstate != cLoldstate)
         {
            cLoldstate = cLstate;
            vPortOn();            
            cLstep = 0;
            cLseq = 0;
         }   
         // Pattern step
         vRunPattern();                      
      break;
      
      case 3:                 // Stopping
         if (cLstate != cLoldstate)
         {
            cLoldstate = cLstate;
            vPortOn();            
            cLstep = 0;
         }   
         // Pattern step
         vStopPattern();                                             
      break;
      
      case 4:                 // Lights on
         if (cLstate != cLoldstate)
         {
            cLoldstate = cLstate;
            vPortOn();            
         }      
      break;
      
      
   
   }
}




